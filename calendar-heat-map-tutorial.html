<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 36 Calendar heat map tutorial | Community Contributions STAT GR 5293</title>
<meta name="description" content="Eva Dai Hi there! Here I want to share with you a way of creating calendar heat map for multiple years. Calendar heat map is a calendar that uses colored cells to show the relative number of a...">
<meta name="generator" content="bookdown 0.25 with bs4_book()">
<meta property="og:title" content="Chapter 36 Calendar heat map tutorial | Community Contributions STAT GR 5293">
<meta property="og:type" content="book">
<meta property="og:description" content="Eva Dai Hi there! Here I want to share with you a way of creating calendar heat map for multiple years. Calendar heat map is a calendar that uses colored cells to show the relative number of a...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 36 Calendar heat map tutorial | Community Contributions STAT GR 5293">
<meta name="twitter:description" content="Eva Dai Hi there! Here I want to share with you a way of creating calendar heat map for multiple years. Calendar heat map is a calendar that uses colored cells to show the relative number of a...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/parallel-coordinates-2.1.8/parcoords.css" rel="stylesheet">
<script src="libs/parcoords-binding-1.0.0/parcoords.js"></script><script src="libs/d3-5.16.0/d3.min.js"></script><link href="libs/wordcloud2-0.0.1/wordcloud.css" rel="stylesheet">
<script src="libs/wordcloud2-0.0.1/wordcloud2-all.js"></script><script src="libs/wordcloud2-0.0.1/hover.js"></script><script src="libs/wordcloud2-binding-0.2.1/wordcloud2.js"></script><link href="libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet">
<script src="libs/dygraphs-1.1.1/dygraph-combined.js"></script><script src="libs/dygraphs-1.1.1/shapes.js"></script><script src="libs/moment-2.8.4/moment.js"></script><script src="libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script><script src="libs/moment-fquarter-1.0.0/moment-fquarter.min.js"></script><script src="libs/dygraphs-binding-1.1.1.6/dygraphs.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/echarts-4.0.0/echarts.min.js"></script><script src="libs/echarts-4.0.0/echarts-wordcloud.min.js"></script><script src="libs/echarts_shapeFile-3.2.2/china.js"></script><script src="libs/echarts_shapeFile-3.2.2/provinceShape.js"></script><script src="libs/echarts_shapeFile-3.2.2/world.js"></script><script src="libs/echarts-binding-0.0.4/echarts.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Community Contributions STAT GR 5293</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome!</a></li>
<li><a class="" href="community-contribution.html"><span class="header-section-number">2</span> Community Contribution</a></li>
<li><a class="" href="github-submission-instructions.html"><span class="header-section-number">3</span> GitHub submission instructions</a></li>
<li><a class="" href="sample-project.html"><span class="header-section-number">4</span> Sample project</a></li>
<li class="book-part">Cheatsheets</li>
<li><a class="" href="tmap-package.html"><span class="header-section-number">5</span> tmap package</a></li>
<li><a class="" href="graphics-cheatsheet-in-ggplot2.html"><span class="header-section-number">6</span> Graphics cheatsheet in ggplot2</a></li>
<li><a class="" href="ggplot2-cheatsheet.html"><span class="header-section-number">7</span> ggplot2 cheatsheet</a></li>
<li><a class="" href="data-preprocessing-cheat-sheet-in-r.html"><span class="header-section-number">8</span> Data preprocessing cheat sheet in R</a></li>
<li><a class="" href="data-wrangling-and-visualization-in-r.html"><span class="header-section-number">9</span> Data Wrangling and Visualization in R</a></li>
<li><a class="" href="ggplot2-cheatsheet-1.html"><span class="header-section-number">10</span> GGplot2 cheatsheet</a></li>
<li><a class="" href="cheat-sheet-for-tidyverse.html"><span class="header-section-number">11</span> Cheat Sheet for Tidyverse</a></li>
<li><a class="" href="memos-checklist-and-usful-links-experience-of-statistical-graphic.html"><span class="header-section-number">12</span> Memos, checklist and usful links: experience of statistical graphic</a></li>
<li><a class="" href="cheatsheet-for-multiple-graphics.html"><span class="header-section-number">13</span> Cheatsheet for multiple graphics</a></li>
<li><a class="" href="useful-setting-of-ggplot2.html"><span class="header-section-number">14</span> Useful setting of ggplot2</a></li>
<li><a class="" href="cheatsheet-for-circlize-package.html"><span class="header-section-number">15</span> Cheatsheet for ‘circlize’ package</a></li>
<li><a class="" href="texts-in-r-graphs-cheat-sheet.html"><span class="header-section-number">16</span> Texts in R Graphs Cheat Sheet</a></li>
<li><a class="" href="dygraphs-package.html"><span class="header-section-number">17</span> dygraphs package</a></li>
<li class="book-part">Tutorials</li>
<li><a class="" href="visualizing-geographical-time-series-data-with-messy-country-name.html"><span class="header-section-number">18</span> Visualizing Geographical Time Series Data With Messy Country Name</a></li>
<li><a class="" href="plotly-package.html"><span class="header-section-number">19</span> Plotly package</a></li>
<li><a class="" href="web-scraping-using-beautifulsoup-in-python.html"><span class="header-section-number">20</span> Web Scraping Using BeautifulSoup in Python</a></li>
<li><a class="" href="a-brief-guide-through-ggplot-via-examples.html"><span class="header-section-number">21</span> A Brief Guide Through ggplot via Examples</a></li>
<li><a class="" href="drawing-five-common-plots-by-ggplot2.html"><span class="header-section-number">22</span> Drawing Five Common Plots by ggplot2</a></li>
<li><a class="" href="compare-different-ways-of-plotting-biplot-mosaicplot-and-heatmap.html"><span class="header-section-number">23</span> Compare different ways of plotting Biplot, Mosaicplot, and Heatmap</a></li>
<li><a class="" href="twitter-api-guide-in-r.html"><span class="header-section-number">24</span> Twitter API guide in R</a></li>
<li><a class="" href="geographical-maps-packages-comparison-ggmap-vs.-ggplot-vs-tmap.html"><span class="header-section-number">25</span> Geographical Maps Packages Comparison: ggmap vs. ggplot vs tmap</a></li>
<li><a class="" href="r-shiny-map-tutorial.html"><span class="header-section-number">26</span> R Shiny Map Tutorial</a></li>
<li><a class="" href="neural-network-ploting-with-bp-algorithm-and-without-algorithm.html"><span class="header-section-number">27</span> Neural Network Ploting with BP Algorithm and without Algorithm</a></li>
<li><a class="" href="wordcloud.html"><span class="header-section-number">28</span> wordcloud</a></li>
<li><a class="" href="linear-modeling-using-r-via-a-soccer-example.html"><span class="header-section-number">29</span> Linear Modeling Using R via a Soccer Example</a></li>
<li><a class="" href="animation-graphs-in-plot_ly-and-gganimate.html"><span class="header-section-number">30</span> Animation graphs in plot_ly and gganimate</a></li>
<li><a class="" href="forest-plots.html"><span class="header-section-number">31</span> Forest Plots</a></li>
<li><a class="" href="differences-between-some-packages-of-visualizaiton.html"><span class="header-section-number">32</span> Differences between some packages of visualizaiton</a></li>
<li><a class="" href="lecture-helper.html"><span class="header-section-number">33</span> Lecture Helper</a></li>
<li><a class="" href="basic-introduction-to-tidyverse.html"><span class="header-section-number">34</span> Basic introduction to tidyverse</a></li>
<li><a class="" href="class_material_code_throughout_this_semester.html"><span class="header-section-number">35</span> class_material_code_throughout_this_semester</a></li>
<li><a class="active" href="calendar-heat-map-tutorial.html"><span class="header-section-number">36</span> Calendar heat map tutorial</a></li>
<li><a class="" href="basic-time-series-analysis-and-prediction.html"><span class="header-section-number">37</span> Basic time series analysis and prediction</a></li>
<li><a class="" href="r-shiny-and-interactive-map-tutorial.html"><span class="header-section-number">38</span> R Shiny and Interactive Map Tutorial</a></li>
<li><a class="" href="extract-data-from-scatterplot.html"><span class="header-section-number">39</span> Extract data from scatterplot</a></li>
<li><a class="" href="tutorial-for-the-r-graph-gallery.html"><span class="header-section-number">40</span> Tutorial for the r graph gallery</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="github-initial-setup.html"><span class="header-section-number">41</span> Github initial setup</a></li>
<li><a class="" href="tutorial-for-pull-request-mergers.html"><span class="header-section-number">42</span> Tutorial for pull request mergers</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/jtr13/cc22spring">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="calendar-heat-map-tutorial" class="section level1" number="36">
<h1>
<span class="header-section-number">36</span> Calendar heat map tutorial<a class="anchor" aria-label="anchor" href="#calendar-heat-map-tutorial"><i class="fas fa-link"></i></a>
</h1>
<p>Eva Dai</p>
<p>Hi there! Here I want to share with you a way of creating calendar heat map for multiple years. Calendar heat map is a calendar that uses colored cells to show the relative number of a variable. The final project of our group is focused on the waiting time of the rides in Disney World. Since the data is highly related to time, I find that calendar heat map can be a good way of representing data from multiple years. In this calendar heat map tutorial, I will show how to plot two types of calendar heat maps, one for data from multiple years and one for a single year.</p>
<div class="sourceCode" id="cb475"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://zoo.R-Forge.R-project.org/">zoo</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-coder.com/">calendR</a></span><span class="op">)</span></code></pre></div>
<p>I. Data processing: date transformation
The original data set comes from the touringplans.com, under the ride “Soarin’”. The data is very large and has 274770 rows. The values for waiting time are scattered in two columns. So first of all we clean them and merge the two columns. And then we choose “datetime” which represents the date and time, and “SPOSTMIN” that represents the waiting time documented. And in order to learn more from this tutorial, I will start with transforming time values accurate to seconds, so the “datetime” column is selected.</p>
<div class="sourceCode" id="cb476"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">soarin</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://cdn.touringplans.com/datasets/soarin.csv"</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">soarin</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   date       datetime            SACTMIN SPOSTMIN
##   &lt;chr&gt;      &lt;dttm&gt;                &lt;dbl&gt;    &lt;dbl&gt;
## 1 01/01/2015 2015-01-01 07:45:15      NA       10
## 2 01/01/2015 2015-01-01 07:52:16      NA       10
## 3 01/01/2015 2015-01-01 08:03:17      NA       10
## 4 01/01/2015 2015-01-01 08:10:16      NA       35
## 5 01/01/2015 2015-01-01 08:17:19      NA       45
## 6 01/01/2015 2015-01-01 08:24:16      NA       35</code></pre>
<div class="sourceCode" id="cb478"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">soarin</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">soarin</span><span class="op">$</span><span class="va">SPOSTMIN</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">==</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="va">soarin</span><span class="op">$</span><span class="va">SPOSTMIN</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">soarin</span><span class="op">$</span><span class="va">SACTMIN</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">}</span>
<span class="op">}</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">soarin</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">SACTMIN</span>,<span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">SPOSTMIN</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   datetime            SPOSTMIN
##   &lt;dttm&gt;                 &lt;dbl&gt;
## 1 2015-01-01 07:45:15       10
## 2 2015-01-01 07:52:16       10
## 3 2015-01-01 08:03:17       10
## 4 2015-01-01 08:10:16       35
## 5 2015-01-01 08:17:19       45
## 6 2015-01-01 08:24:16       35</code></pre>
<p>If the date information we get in the data file is more accurate than just date, we need to first transform it<br>
We can use the zoo package to easily transform into date format</p>
<div class="sourceCode" id="cb480"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">datetime</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   datetime            SPOSTMIN date      
##   &lt;dttm&gt;                 &lt;dbl&gt; &lt;date&gt;    
## 1 2015-01-01 07:45:15       10 2015-01-01
## 2 2015-01-01 07:52:16       10 2015-01-01
## 3 2015-01-01 08:03:17       10 2015-01-01
## 4 2015-01-01 08:10:16       35 2015-01-01
## 5 2015-01-01 08:17:19       45 2015-01-01
## 6 2015-01-01 08:24:16       35 2015-01-01</code></pre>
<p>Then we need to calculate the daily average of the waiting time in order to make a calendar heatmap.</p>
<div class="sourceCode" id="cb482"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new</span> <span class="op">&lt;-</span> <span class="va">df</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_everyday <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">SPOSTMIN</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>To create a calendar heatmap, we need to first create variables such as weekday, year, month, week, and week of month. Here I use the “lubridate” package that helps to calculate the day os a week for each date in the data frame.</p>
<p>wday() calculates the weekday of a given date. with label=TRUE, the output will be in verbal format, such as “Sun”, “Mon”, etc. Otherwise, the number of the weekday from 1 to 7 will be calculated</p>
<div class="sourceCode" id="cb483"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new</span><span class="op">$</span><span class="va">weekday</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html">wday</a></span><span class="op">(</span><span class="va">new</span><span class="op">$</span><span class="va">date</span>,label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Similarly, year() calculates the year of the date and month() calculates the month of the date.</p>
<div class="sourceCode" id="cb484"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">new</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span>
<span class="va">new</span><span class="op">$</span><span class="va">month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">new</span><span class="op">$</span><span class="va">date</span>, label<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>strftime() converts the date into the week number. With format=“%V”, week of the year from 1-53 will be given with Monday as the start of the week. Since we use Sunday as the start of the week, we need to add 1 into the function</p>
<div class="sourceCode" id="cb485"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new</span><span class="op">$</span><span class="va">week</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strftime</a></span><span class="op">(</span><span class="va">new</span><span class="op">$</span><span class="va">date</span><span class="op">+</span><span class="fl">1</span>, format <span class="op">=</span> <span class="st">"%V"</span><span class="op">)</span></code></pre></div>
<p>Since it is hard to find an R package that calculates the week of month, I created a function that takes date as an input. The function takes Sunday as the start of the week and the output will be an integer value specifying the week number of the month that the given date is on.</p>
<div class="sourceCode" id="cb486"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">weekofmonth</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">{</span>
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strftime</a></span><span class="op">(</span><span class="va">date</span>, format <span class="op">=</span> <span class="st">"%U"</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strftime</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date</span>, unit<span class="op">=</span><span class="st">"months"</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%U"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">new</span><span class="op">$</span><span class="va">weekofmonth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu">weekofmonth</span><span class="op">(</span><span class="va">new</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We are now done with data processing. The data frame now includes all the factors we need for plotting.</p>
<div class="sourceCode" id="cb487"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">new</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 7
##   date       mean_everyday weekday year  month week  weekofmonth
##   &lt;date&gt;             &lt;dbl&gt; &lt;ord&gt;   &lt;fct&gt; &lt;ord&gt; &lt;chr&gt; &lt;fct&gt;      
## 1 2015-01-01          89.6 Thu     2015  Jan   01    1          
## 2 2015-01-02          81.1 Fri     2015  Jan   01    1          
## 3 2015-01-03          73.4 Sat     2015  Jan   01    1          
## 4 2015-01-04          58.1 Sun     2015  Jan   02    2          
## 5 2015-01-05          58.4 Mon     2015  Jan   02    2          
## 6 2015-01-06          55.6 Tue     2015  Jan   02    2</code></pre>
<ol start="2" style="list-style-type: upper-roman">
<li>Plotting Calendar heat map<br>
First we create the calendar heat map for all years in the data frame. The blanks on the graph is because of the missing of data for specific dates in the data frame.</li>
</ol>
<div class="sourceCode" id="cb489"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">new</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">weekday</span>, <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">weekofmonth</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">mean_everyday</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">year</span><span class="op">~</span><span class="va">month</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"#FFE6EE"</span> , high<span class="op">=</span><span class="st">"#bb1919"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Calendar Heatmap"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Weekday"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"Average Waiting Time"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Week Number"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>label<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/abbreviate.html">abbreviate</a></span><span class="op">(</span><span class="va">x</span>, minlength<span class="op">=</span><span class="fl">1</span>, strict <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="calendar_heat_map_tutorial_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;"></div>
<p>From the calendar heat map for the “Soarin’” ride of Disney World, we can easily see which days have a high average waiting time and which days have a low waiting time. And by comparing different levels of color fill over years, we can see the overall waiting pattern during a year and find which months have lower average waiting time. And we can also compare across years to see the overall crowdness of the year. For instance, the color fills for year 2021 are lighter than the other years, which can be considered directly impacted by the current pandemic.</p>
<p>If we want to take a closer look and create a heat map for a specific year from the dataframe, we can plot using the following code. Here we take 2015 as an example.</p>
<div class="sourceCode" id="cb490"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">2015</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">new</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span><span class="op">==</span><span class="va">y</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">weekday</span>, <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">weekofmonth</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">mean_everyday</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">month</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"#FFE6EE"</span>, high<span class="op">=</span><span class="st">"#bb1919"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Calendar Heatmap"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Weekday"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"Average Waiting Time"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Week Number"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="calendar_heat_map_tutorial_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;"></div>
<p>For a faster processing of the data into a calendar heatmap, we can use the package “calendR”. The package automatically creates the calendar of a specific year (or month), and fills color with values from the dataframe. We can specify the low and high colors and the colors to be filled in will be specified in “special.days”. For instance, we can create a similar calendar heatmap for year 2015.</p>
<div class="sourceCode" id="cb491"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/calendR/man/calendR.html">calendR</a></span><span class="op">(</span>year<span class="op">=</span><span class="fl">2015</span>, start<span class="op">=</span><span class="st">"S"</span>, 
        special.days <span class="op">=</span> <span class="op">(</span><span class="va">new</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span><span class="op">==</span><span class="fl">2015</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">mean_everyday</span>, 
        gradient<span class="op">=</span><span class="cn">TRUE</span>, 
        low.col<span class="op">=</span><span class="st">"#f9d7d7"</span>, 
        special.col<span class="op">=</span><span class="st">"#bb1919"</span>,
        legend.pos <span class="op">=</span> <span class="st">"right"</span>,
        legend.title <span class="op">=</span> <span class="st">"Average Waiting Time"</span>,
        weeknames.size<span class="op">=</span><span class="fl">2.5</span>,
        day.size<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="calendar_heat_map_tutorial_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;"></div>
<p>However, the package can create a calendar heatmap for at most a year. If we want to create a heatmap using all years from the data, we still need to plot using ggplot as drawn above.</p>
<p>As we can see, calendar heat map can be an efficient way of visualizing the variable value that we want to represent. And I hope this tutorial can be helpful!</p>
<p>References<br><a href="https://touringplans.com/walt-disney-world/crowd-calendar#DataSets" class="uri">https://touringplans.com/walt-disney-world/crowd-calendar#DataSets</a><br><a href="https://stackoverflow.com/questions/25199851/r-how-to-get-the-week-number-of-the-month" class="uri">https://stackoverflow.com/questions/25199851/r-how-to-get-the-week-number-of-the-month</a><br><a href="https://stackoverflow.com/questions/48301514/r-fit-heat-map-into-grid-lines-on-calendar-heatmap" class="uri">https://stackoverflow.com/questions/48301514/r-fit-heat-map-into-grid-lines-on-calendar-heatmap</a><br><a href="https://r-charts.com/evolution/monthly-calendar-heatmap/" class="uri">https://r-charts.com/evolution/monthly-calendar-heatmap/</a></p>

</div>
  <div class="chapter-nav">
<div class="prev"><a href="class_material_code_throughout_this_semester.html"><span class="header-section-number">35</span> class_material_code_throughout_this_semester</a></div>
<div class="next"><a href="basic-time-series-analysis-and-prediction.html"><span class="header-section-number">37</span> Basic time series analysis and prediction</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav"><li><a class="nav-link" href="#calendar-heat-map-tutorial"><span class="header-section-number">36</span> Calendar heat map tutorial</a></li></ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/jtr13/cc22spring/blob/main/calendar_heat_map_tutorial.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/jtr13/cc22spring/edit/main/calendar_heat_map_tutorial.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Community Contributions STAT GR 5293</strong>" was written by . It was last built on 2022-04-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
